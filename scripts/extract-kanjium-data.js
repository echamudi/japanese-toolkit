const fs = require('fs');
const path = require('path');
const csvtojson = require('csvtojson');

(async () => {
    const targetDir = path.join('.', 'lib', 'kanjium');
    const csvtojsonConfig = {
        delimiter: '\t',
        noheader: 'true',
        headers: [
            "key",
            "val",
        ],
    };

    // Generate folder
    fs.mkdirSync(targetDir, { recursive: true });

    // Extractor from source txt to kanjium json
    async function extractKanjium(name) {
        const obj = {};


        const objRaw = await csvtojson(csvtojsonConfig)
            .fromFile(
                path.join(__dirname, '..', 'source', 'kanjium-' + name + '.txt')
            );

        objRaw.forEach((el) => {
            obj[el.key] = el.val.split(',')
        });
    
        // Save antonyms
        fs.writeFileSync(path.join(targetDir, 'kanjium-' + name + '.json'), JSON.stringify(obj, null, 2));
    }

    extractKanjium('antonyms');
    extractKanjium('lookalikes');
    extractKanjium('synonyms');
    extractKanjium('variants');

    const notice = `
This folder is generated by script. Please don't edit the content manually.
The pitch accent notation, verb particle data, phonetics, homonyms and other additions or modifications to EDICT, KANJIDIC or KRADFILE.
Data taken from kanjium https://github.com/mifunetoshiro/kanjium
`;
    
    // Add notice
    fs.writeFileSync(path.join(targetDir, '_notice.txt'), notice, function(err) {
        if (err) {
            console.log(err);
        }
    });
    
})();
